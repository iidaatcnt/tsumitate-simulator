# 副業収入投資シミュレーター 開発仕様書

**バージョン**: 1.0
**最終更新日**: 2025年10月7日
**リポジトリ**: https://github.com/iidaatcnt/tsumitate-simulator

---

## 📋 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [現在の実装状況](#現在の実装状況)
3. [技術構成](#技術構成)
4. [機能仕様](#機能仕様)
5. [ファイル構成と役割](#ファイル構成と役割)
6. [計算ロジック](#計算ロジック)
7. [UI/UX仕様](#uiux仕様)
8. [今後の拡張案](#今後の拡張案)
9. [開発ガイド](#開発ガイド)

---

## プロジェクト概要

### 目的
月々の副業収入を投資に回した場合の将来の資産額をシミュレーションし、複利効果を視覚的に理解できるWebアプリケーション。

### ターゲットユーザー
- 投資初心者
- 副業を始めて投資を検討している人
- 長期積立投資の効果を知りたい人

### デモサイト
https://iidaatcnt.github.io/tsumitate-simulator/

---

## 現在の実装状況

### ✅ 実装済み機能

1. **入力機能**
   - 開始日（年・月）の設定
   - 毎月の投資額の入力
   - 投資期間の選択（スライダー: 1-50年）
   - 想定利回りの選択（スライダー: 0-20%、0.5%刻み）

2. **計算機能**
   - 複利計算ロジック（標準的な積立投資の公式を使用）
   - リアルタイム計算（入力変更と同時に結果更新）
   - 終了日の自動計算

3. **表示機能**
   - 最終積立金額の表示
   - 投資元本と運用益の内訳表示
   - 運用益率（%）の表示
   - 貯金のみの場合との比較表示
   - パラメータに応じた動的な説明文生成

4. **UI/UX**
   - レスポンシブデザイン（スマホ・タブレット・PC対応）
   - 視覚的に分かりやすいカラースキーム
   - スライダーによる直感的な操作
   - リアルタイムフィードバック

### 🚧 未実装機能（拡張案）

- グラフ表示（資産推移の可視化）
- 年次推移の詳細テーブル
- 複数シナリオの比較機能
- PDF/CSV出力機能
- 目標金額設定機能
- 手取り計算（税金考慮）

---

## 技術構成

### 技術スタック
- **HTML5**: 構造定義
- **CSS3**: スタイリング、レスポンシブ対応
- **Vanilla JavaScript (ES6+)**: ロジック実装

### 特徴
- ✅ ビルド不要（静的ファイルのみ）
- ✅ 依存関係なし（外部ライブラリ不使用）
- ✅ GitHub Pages対応
- ✅ モダンブラウザで動作

### ブラウザ対応
- Chrome（最新版）
- Safari（最新版）
- Firefox（最新版）
- Edge（最新版）

---

## 機能仕様

### 入力パラメータ

| 項目 | 入力形式 | 初期値 | 制約 | 備考 |
|------|----------|--------|------|------|
| 開始年 | 数値入力 | 現在の年 | 2020-2100 | - |
| 開始月 | 数値入力 | 現在の月 | 1-12 | - |
| 毎月の投資額 | 数値入力 | 50,000円 | 0以上 | 1000円刻み推奨 |
| 投資期間 | スライダー | 20年 | 1-50年 | 1年刻み |
| 想定利回り | スライダー | 7% | 0-20% | 0.5%刻み |

### 出力項目

1. **終了日**: 開始日 + 投資期間で自動計算
2. **説明文**: 「月○万円を優良なインデックスファンド（年利○%）に○年間投資した結果のシミュレーション」
3. **最終積立金額**: 複利計算の結果（円単位、3桁カンマ区切り）
4. **投資元本**: 毎月の投資額 × 月数
5. **運用益**: 最終積立金額 - 投資元本
6. **運用益率**: (運用益 / 投資元本) × 100 (%)
7. **貯金のみの場合**: 投資元本と同額
8. **差額**: 運用益と同額

### バリデーション

- 開始年: 2020-2100の範囲
- 開始月: 1-12の範囲
- 毎月の投資額: 0以上の数値
- 投資期間: 1-50年の範囲
- 想定利回り: 0-20%の範囲

---

## ファイル構成と役割

```
tsumitate-simulator/
├── index.html              # メインHTML（構造定義）
├── css/
│   └── style.css          # スタイル定義（デザイン、レスポンシブ）
├── js/
│   ├── calculator.js      # 複利計算ロジック
│   └── app.js             # UI制御、イベント処理
├── README.md              # プロジェクト説明、使い方
├── SPEC.md                # 開発仕様書（このファイル）
├── tsumitate-simulator.md # 元の要件定義書
└── .gitignore             # Git除外設定
```

### 各ファイルの詳細

#### `index.html`
- アプリの構造を定義
- セマンティックHTML使用
- 入力フォーム、結果表示エリア、注意事項を含む

#### `css/style.css`
- 全体のデザインとレイアウト
- レスポンシブ対応（メディアクエリ）
- グラデーション背景、カラースキーム
- フォームスタイル、スライダーカスタマイズ

#### `js/calculator.js`
**役割**: 複利計算の数式実装

**関数**:
- `calculateCompoundInterest(params)`: 複利計算を実行
  - パラメータ: startYear, startMonth, monthlyAmount, annualRate, years
  - 戻り値: finalAmount, principal, profit, profitRate, endYear, endMonth
- `formatCurrency(value)`: 数値を3桁カンマ区切りでフォーマット

#### `js/app.js`
**役割**: UI制御とイベント処理

**主要機能**:
- DOM要素の取得と管理
- ユーザー入力の検知
- 計算実行と結果の画面反映
- 説明文の動的生成
- 初期化処理

**関数**:
- `getInputValues()`: 入力値を取得
- `updateDisplay()`: 画面を更新（計算実行 → 結果表示）
- `setupEventListeners()`: イベントリスナーを設定
- `init()`: アプリ初期化（初期値設定、イベント設定、初回表示）

---

## 計算ロジック

### 複利計算の公式

```
最終積立金額 (FV) = 毎月積立額 (PMT) × [(1 + r)^n - 1] / r

ここで:
- FV: Future Value（将来価値）
- PMT: Payment（定期的な支払額）
- r: 月利率 = 年利率 / 12 / 100
- n: 総月数 = 投資期間（年） × 12
```

### 特殊ケース
- **年利が0%の場合**: FV = PMT × n（元本のみ）

### 計算例

**入力**:
- 毎月の投資額: 50,000円
- 想定利回り: 7%（年率）
- 投資期間: 20年

**計算過程**:
```
月利 r = 7 / 12 / 100 = 0.005833...
総月数 n = 20 × 12 = 240ヶ月
元本 = 50,000 × 240 = 12,000,000円

最終積立金額 = 50,000 × [(1.005833)^240 - 1] / 0.005833
            = 50,000 × 520.927
            = 26,046,333円

運用益 = 26,046,333 - 12,000,000 = 14,046,333円
運用益率 = (14,046,333 / 12,000,000) × 100 = 117%
```

**出力**:
- 最終積立金額: 26,046,333円
- 元本: 12,000,000円
- 運用益: 14,046,333円 (+117%)

---

## UI/UX仕様

### カラースキーム

```css
/* 背景 */
グラデーション: #f0fdf4 → #eff6ff（緑から青へ）

/* メインカード */
背景: 白 (#ffffff)
シャドウ: rgba(0, 0, 0, 0.1)

/* 結果表示エリア */
背景グラデーション: #fef2f2 → #fff7ed（赤からオレンジへ）
ボーダー: #fca5a5（赤系）

/* アクセントカラー */
メイン: #10b981（緑）
エラー/強調: #dc2626（赤）
セカンダリ: #2563eb（青）
テキスト: #1f2937（濃いグレー）
サブテキスト: #6b7280（グレー）
```

### フォントサイズ

| 要素 | サイズ | 備考 |
|------|--------|------|
| タイトル | 2rem (32px) | スマホ: 1.5rem (24px) |
| サブタイトル | 1.125rem (18px) | スマホ: 1rem (16px) |
| 結果タイトル | 1.25rem (20px) | - |
| 結果金額 | 3rem (48px) | スマホ: 2rem (32px) |
| 入力ラベル | 0.875rem (14px) | - |
| 注意事項 | 0.75rem (12px) | - |

### レスポンシブ対応

**ブレークポイント**: 640px

```css
@media (max-width: 640px) {
    /* スマホ向けの調整 */
    - パディング縮小
    - フォントサイズ縮小
    - 要素間の余白調整
}
```

### インタラクション

1. **リアルタイム更新**
   - すべての入力要素で `input` イベントを監視
   - 変更時に即座に `updateDisplay()` を実行
   - デバウンス処理なし（計算が軽量なため）

2. **スライダー**
   - カスタムスタイル適用
   - つまみ色: #10b981（緑）
   - ドラッグ時のフィードバック

3. **フォーカス状態**
   - 入力フィールドフォーカス時: 緑色のリング表示
   - ボックスシャドウで視覚的フィードバック

---

## 今後の拡張案

### 優先度: 高

#### 1. グラフ表示機能
**目的**: 資産推移を視覚化

**仕様**:
- 積み上げ棒グラフまたは折れ線グラフ
- X軸: 年数、Y軸: 金額
- 2つのデータ系列: 元本 / 運用益
- Chart.js または Canvas API で実装

**実装ファイル**:
- `js/chart.js` を追加
- `updateDisplay()` でグラフも更新

#### 2. 年次推移テーブル
**目的**: 詳細な数値を確認

**表示内容**:
| 年 | 元本累計 | 資産額 | 運用益 |
|----|---------|--------|--------|
| 1年 | 600,000 | 625,320 | 25,320 |
| ... | ... | ... | ... |

**実装ファイル**:
- `js/table.js` を追加
- HTMLに `<div id="yearlyTable"></div>` を追加

### 優先度: 中

#### 3. シナリオ比較機能
**目的**: 複数の条件を並べて比較

**仕様**:
- 3つのシナリオ（保守的: 3%、標準: 7%、積極的: 10%）
- 横並びで結果表示
- モバイルは縦積み

#### 4. 目標金額設定
**目的**: 「○千万円貯めるには？」を逆算

**仕様**:
- 目標金額を入力
- 必要な投資額または期間を計算
- 達成率の表示

### 優先度: 低

#### 5. PDF/CSV出力
**目的**: 結果を保存・印刷

**実装**:
- jsPDF または html2canvas で実装
- 年次推移データをCSV出力

#### 6. 副業手取り計算
**目的**: 税金を考慮した実質投資可能額

**仕様**:
- 副業収入から所得税・住民税を概算
- 手取り = 収入 × (1 - 0.2042) ※簡易計算

---

## 開発ガイド

### ローカル開発環境のセットアップ

1. **リポジトリのクローン**
```bash
git clone https://github.com/iidaatcnt/tsumitate-simulator.git
cd tsumitate-simulator
```

2. **ブラウザで開く**
```bash
open index.html
```

または、HTTPサーバーを起動:
```bash
# Python
python3 -m http.server 8000

# Node.js
npx serve
```

### コーディング規約

#### HTML
- セマンティックHTMLを使用
- ID命名: キャメルケース（例: `startYear`, `finalAmount`）
- クラス命名: ケバブケース（例: `form-group`, `result-section`）

#### CSS
- BEM的な命名規則（ただし厳密ではない）
- レスポンシブはモバイルファーストではなく、デスクトップ優先
- カラー変数は使用せず直接指定（シンプルさ優先）

#### JavaScript
- ES6+の構文を使用
- 関数はJSDoc形式でコメント
- グローバル変数は最小限に
- `elements` オブジェクトでDOM要素を一元管理

### 新機能の追加方法

#### 例: グラフ機能を追加する場合

1. **HTMLに要素を追加**
```html
<div id="chartContainer" class="chart-container">
    <canvas id="assetChart"></canvas>
</div>
```

2. **CSSでスタイル定義**
```css
.chart-container {
    margin-top: 1.5rem;
    padding: 1rem;
    background: white;
    border-radius: 0.5rem;
}
```

3. **JSファイルを作成**: `js/chart.js`
```javascript
function drawChart(yearlyData) {
    // グラフ描画ロジック
}
```

4. **HTMLで読み込み**
```html
<script src="js/chart.js"></script>
```

5. **app.jsから呼び出し**
```javascript
function updateDisplay() {
    // 既存の処理

    // グラフを更新
    const yearlyData = calculateYearlyData(inputs);
    drawChart(yearlyData);
}
```

### Git運用

#### ブランチ戦略
- `main`: 本番環境（GitHub Pages）
- `develop`: 開発用（新機能追加時）
- `feature/*`: 機能開発ブランチ

#### コミットメッセージ
```
[機能追加] グラフ表示機能を実装

- Chart.jsを使用した資産推移グラフ
- 元本と運用益を色分けして表示
- レスポンシブ対応
```

### デプロイ

#### GitHub Pagesへのデプロイ
1. `main` ブランチにプッシュ
2. 自動的にGitHub Pagesに反映される
3. 数分後に https://iidaatcnt.github.io/tsumitate-simulator/ で確認可能

### テストケース

#### 基本計算テスト
| 毎月の投資額 | 年利 | 期間 | 期待結果（概算） |
|-------------|------|------|-----------------|
| 50,000円 | 7% | 20年 | 26,046,333円 |
| 30,000円 | 5% | 30年 | 24,967,104円 |
| 100,000円 | 10% | 10年 | 20,484,496円 |

#### エッジケース
- 年利0%の場合: 元本のみ（月額 × 12 × 年数）
- 最小値: 月1円、年利0%、1年
- 最大値: 大きな金額でも計算が破綻しないこと

#### ブラウザテスト
- Chrome, Safari, Firefox, Edgeで動作確認
- スマホ（iOS Safari, Android Chrome）で動作確認

---

## 免責事項・注意事項

以下の注意事項をアプリ内に明記:

1. この計算はシミュレーションであり、実際の運用結果を保証するものではありません。
2. 投資には元本割れのリスクがあります。
3. 税金や手数料は考慮されていません。
4. 実際の投資判断は専門家にご相談ください。

---

## 参考資料

### 複利計算
- [積立投資の将来価値計算](https://www.investopedia.com/terms/f/future-value-annuity.asp)

### デザイン
- [Tailwind CSS Colors](https://tailwindcss.com/docs/customizing-colors)

### 投資の基礎知識
- [金融庁: つみたてNISA](https://www.fsa.go.jp/policy/nisa2/index.html)

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025-10-07 | 初版作成（バニラJS実装版） |

---

**作成者**: iidaatcnt
**ライセンス**: MIT
